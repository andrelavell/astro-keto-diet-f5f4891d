---
import BaseLayout from "~/layouts/BaseLayout.astro";
import { getCollection } from 'astro:content';

const posts = await getCollection('blog', ({ data }) => import.meta.env.DEV || data.draft === false);
const categories = Array.from(new Set(posts.map((p) => p.data.category).filter(Boolean)))
  .sort((a, b) => (a as string).localeCompare(b as string)) as string[];
---
<BaseLayout title="Categories">
  <article class="prose mx-auto">
    <header class="not-prose mb-6">
      <h1 class="text-4xl font-bold tracking-tight">Categories</h1>
      <p class="mt-1 text-sm text-zinc-500">Browse articles by category.</p>
    </header>

    {categories.length === 0 ? (
      <p class="text-zinc-500">No categories yet.</p>
    ) : (
      <ul class="flex flex-wrap gap-3">
        {categories.map((c) => (
          <li>
            <a href={`/categories/${encodeURIComponent(c)}`} class="rounded-md bg-zinc-100 px-3 py-1 text-sm font-medium text-zinc-800 hover:bg-zinc-200 dark:bg-zinc-800 dark:text-zinc-200 dark:hover:bg-zinc-700">{c}</a>
          </li>
        ))}
      </ul>
    )}
  </article>
</BaseLayout>
