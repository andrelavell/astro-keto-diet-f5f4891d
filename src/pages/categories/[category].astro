---
import BaseLayout from "~/layouts/BaseLayout.astro";
import TagPill from "~/components/Tag.astro";
import { getCollection, type CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => import.meta.env.DEV || data.draft === false);
  const categorySet = new Set(posts.map((p) => p.data.category).filter(Boolean) as string[]);
  return Array.from(categorySet).map((category) => ({
    params: { category },
    props: { category, posts: posts.filter((p) => p.data.category === category) }
  }));
}

const { category, posts } = Astro.props as { category: string; posts: CollectionEntry<'blog'>[] };
---
<BaseLayout title={`Category: ${category}`}>
  <h1 class="mb-6 text-3xl font-bold">Category: {category}</h1>
  {posts.length === 0 ? (
    <p class="text-zinc-500">No posts for this category yet.</p>
  ) : (
    <ul class="space-y-8">
      {posts.map((post) => (
        <li>
          <a href={`/blog/${post.slug}`} class="block">
            <h2 class="text-2xl font-semibold hover:underline">{post.data.title}</h2>
            <p class="mt-1 text-zinc-600 dark:text-zinc-300">{post.data.description}</p>
            <p class="mt-2 text-sm text-zinc-500">
              <time datetime={post.data.pubDate.toISOString()}>{post.data.pubDate.toDateString()}</time>
            </p>
            {post.data.tags.length > 0 && (
              <div class="mt-2 flex flex-wrap gap-2">
                {post.data.tags.map((t: string) => <TagPill tag={t} />)}
              </div>
            )}
          </a>
        </li>
      ))}
    </ul>
  )}
</BaseLayout>
